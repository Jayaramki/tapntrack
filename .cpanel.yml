---
deployment:
  tasks:
    - export DEPLOYPATH=/home/tapntrac/public_html/devapi.tapntrack.in/
    - echo "Deploying to $DEPLOYPATH"
    - /bin/cp -R app $DEPLOYPATH
    - /bin/cp -R bootstrap $DEPLOYPATH
    - /bin/cp -R config $DEPLOYPATH
    - /bin/cp -R database $DEPLOYPATH
    - /bin/cp -R public $DEPLOYPATH
    - /bin/cp -R resources $DEPLOYPATH
    - /bin/cp -R routes $DEPLOYPATH
    - /bin/cp -R storage $DEPLOYPATH
    - /bin/cp -R tests $DEPLOYPATH
    - /bin/cp artisan $DEPLOYPATH
    - /bin/cp composer.json $DEPLOYPATH
    - /bin/cp package.json $DEPLOYPATH
    - echo "Files copied to $DEPLOYPATH"
    - cd $DEPLOYPATH
    - if [ ! -f composer.phar ]; then echo "Installing Composer"; curl -sS https://getcomposer.org/installer | php; fi
    - echo "Running Composer install"
    - php composer.phar install --optimize-autoloader --no-dev
    - echo "Dumping autoload"
    - php composer.phar dump-autoload --optimize
    - echo "Running Artisan commands"
    - php artisan passport:keys
    - php artisan route:cache
    - php artisan view:cache
    - chmod -R 755 storage
    - chmod -R 755 bootstrap/cache
    - echo "Deployment completed"
